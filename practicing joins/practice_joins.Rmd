---
title: "Practicing joins"
author: "Template: Ian Hussey; content: [Mathumitha]"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_folding: hide
    highlight: haddock
    theme: flatly
    toc: yes
    toc_float: yes
---

```{r, include=FALSE}

knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE)

```

# Dependencies

```{r}

library(dplyr)
library(readr)

```

# Get data

```{r}

data_unique_id_subset <- read_csv("data_unique_id_subset.csv")
data_age_gender_subset <- read_csv("data_age_gender_subset.csv")
data_amp_summary_subset <- read_csv("data_amp_summary_subset.csv")
data_selfreport_summary_subset <- read_csv("data_selfreport_summary_subset.csv")

nrow(data_unique_id_subset)
nrow(data_age_gender_subset)
nrow(data_amp_summary_subset)
nrow(data_selfreport_summary_subset)

```

# Practicing joins

Using the data frames below and functions from the _join family, write code to do the following joins.  

## Practice 1

create 'data_combined' by joining data_amp_summary_subset and data_age_gender_subset so that unique_ids in either data frame are retained. which join is this? implement it. 

```{r}

data_combined <- full_join(data_amp_summary_subset,data_age_gender_subset,by= c("unique_id"))


?full_join

```

## Practice 2

create 'data_self_reports_and_their_amp_data' by joining data_selfreport_summary_subset and data_amp_summary_subset so that all participants have self-report data, + AMP data if available. which join is this? implement it. 

```{r}
data_self_reports_and_their_amp_data <- left_join(data_selfreport_summary_subset,data_amp_summary_subset,by= "unique_id")

#chatgpt
data_self_reports_and_their_amp_data <- data_selfreport_summary_subset %>%
  filter(!is.na(unique_id)) %>%
  left_join(data_amp_summary_subset, by = "unique_id")
 # Exclude NA in unique_id from self-report data

#NA is still in it 
```

## Practice 3

do the opposite: create 'data_amp_data_and_their_self_reports' by joining data_amp_summary_subset and data_selfreport_summary_subset so that all participants have AMP data, + self-report data if available. which join is this? implement it. 

```{r}

# data_amp_data_and_their_self_reports <- 

data_amp_data_and_their_self_reports <- right_join(data_selfreport_summary_subset,data_amp_summary_subset, by="unique_id")

# again Problem with NA
```

## Practice 4

create data_combined_2 by joining 'data_combined' and data_selfreport_summary_subset only unique_ids already present in data_combined are retained. which join is this? implement it. 

```{r}

data_combined_2<- inner_join(data_combined, data_selfreport_summary_subset, by = "unique_id")

```

## Practice 5

create 'data_missing_ids' which should list the unique_ids are missing from data_unique_id_subset but are present in at least one of data_age_gender_subset, data_amp_summary_subset, and data_selfreport_summary_subset. This will require two different joins. Which? Implement them.

```{r}
colnames(data_age_gender_subset)
colnames(data_amp_summary_subset)
colnames(data_selfreport_summary_subset)

combined_ids <- full_join(data_age_gender_subset,
                          data_amp_summary_subset, 
                          by = "unique_id") %>% full_join(data_selfreport_summary_subset, by = "unique_id")

data_missing_ids <- anti_join(combined_ids,data_unique_id_subset,by="unique_id") %>%  select(unique_id) %>% distinct()


```



